<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i t·∫≠p C·∫•p s·ªë nh√¢n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .info-bar {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }

        .info-item {
            text-align: center;
            animation: popIn 0.6s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }

        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            animation: questionSlide 0.5s ease-out;
        }

        @keyframes questionSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        .difficulty-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .difficulty-easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #e8edff;
            font-weight: bold;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
            animation: correctPulse 0.6s ease;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option-label {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .hint-section {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            display: none;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .hint-section.show {
            display: block;
        }

        .hint-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint-text {
            color: #856404;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            animation: alertSlide 0.5s ease-out;
        }

        @keyframes alertSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .result-card {
            text-align: center;
            padding: 40px;
        }

        .result-score {
            font-size: 72px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
            animation: scoreCount 1s ease-out;
        }

        @keyframes scoreCount {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            animation: resultPop 0.6s ease-out;
        }

        @keyframes resultPop {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        .result-item-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-item-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .review-section {
            margin-top: 30px;
            text-align: left;
        }

        .review-question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .review-question.wrong {
            border-left-color: #dc3545;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-correct {
            background: #d4edda;
            color: #155724;
        }

        .status-wrong {
            background: #f8d7da;
            color: #721c24;
        }

        .expired-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.5s ease-in;
        }

        .expired-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            animation: popIn 0.8s ease-out;
        }

        .expired-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }

            .info-bar {
                flex-direction: column;
                gap: 10px;
            }

            .question-text {
                font-size: 16px;
            }

            .result-score {
                font-size: 48px;
            }

            .result-details {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        .timer-warning {
            color: #dc3545;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card" id="mainCard">
            <div id="app"></div>
        </div>
    </div>

    <script>
        const QUIZ_CONFIG = {
            subject: "C·∫•p s·ªë nh√¢n - B√†i to√°n th·ª±c t·∫ø",
            totalTime: 30 * 60,
            expiryDays: 3,
            maxAttempts: 2,
            adaptiveEnabled: true,
            timeThresholds: {
                easy: 120,
                medium: 180,
                hard: 300
            },
            consecutiveWrongLimit: 3
        };

        const QUESTIONS = [
            // C√¢u d·ªÖ (5 c√¢u)
            {
                id: 1,
                difficulty: "easy",
                text: "M·ªôt vi khu·∫©n ph√¢n chia th√†nh 2 con sau m·ªói gi·ªù. Ban ƒë·∫ßu c√≥ 1 vi khu·∫©n, sau 5 gi·ªù c√≥ bao nhi√™u vi khu·∫©n?",
                options: [
                    "16 vi khu·∫©n",
                    "32 vi khu·∫©n",
                    "64 vi khu·∫©n",
                    "128 vi khu·∫©n"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 2,
                difficulty: "easy",
                text: "M·ªôt qu·∫£ b√≥ng ƒë∆∞·ª£c th·∫£ t·ª´ ƒë·ªô cao 10m, m·ªói l·∫ßn ch·∫°m ƒë·∫•t n√≥ n·∫£y l√™n ƒë∆∞·ª£c 1/2 ƒë·ªô cao tr∆∞·ªõc ƒë√≥. ƒê·ªô cao sau l·∫ßn n·∫£y th·ª© 3 l√† bao nhi√™u?",
                options: [
                    "0.625m",
                    "1.25m",
                    "2.5m",
                    "5m"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 3,
                difficulty: "easy",
                text: "M·ªôt ng∆∞·ªùi g·ª≠i ti·∫øt ki·ªám 10 tri·ªáu ƒë·ªìng v·ªõi l√£i su·∫•t k√©p 0.5% m·ªói th√°ng. Sau 1 th√°ng, s·ªë ti·ªÅn g·ªëc v√† l√£i l√† bao nhi√™u?",
                options: [
                    "10.05 tri·ªáu",
                    "10.5 tri·ªáu",
                    "10.055 tri·ªáu",
                    "11 tri·ªáu"
                ],
                correct: 0,
                hint: null
            },
            {
                id: 4,
                difficulty: "easy",
                text: "D√¢n s·ªë m·ªôt th√†nh ph·ªë l√† 100,000 ng∆∞·ªùi v√† tƒÉng 2% m·ªói nƒÉm. Sau 2 nƒÉm d√¢n s·ªë l√† bao nhi√™u ng∆∞·ªùi?",
                options: [
                    "104,000 ng∆∞·ªùi",
                    "104,040 ng∆∞·ªùi",
                    "102,000 ng∆∞·ªùi",
                    "106,000 ng∆∞·ªùi"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 5,
                difficulty: "easy",
                text: "M·ªôt chi·∫øc xe gi·∫£m gi√° 10% m·ªói nƒÉm so v·ªõi nƒÉm tr∆∞·ªõc. Gi√° ban ƒë·∫ßu l√† 500 tri·ªáu. Sau 2 nƒÉm gi√° xe c√≤n bao nhi√™u?",
                options: [
                    "400 tri·ªáu",
                    "405 tri·ªáu",
                    "450 tri·ªáu",
                    "425 tri·ªáu"
                ],
                correct: 1,
                hint: null
            },
            // C√¢u trung b√¨nh (3 c√¢u)
            {
                id: 6,
                difficulty: "medium",
                text: "M·ªôt c√¥ng ty c√≥ doanh thu nƒÉm ƒë·∫ßu l√† 2 t·ª∑ ƒë·ªìng v√† tƒÉng tr∆∞·ªüng 15% m·ªói nƒÉm. H·ªèi sau 4 nƒÉm t·ªïng doanh thu t√≠ch l≈©y (c·ªông d·ªìn 4 nƒÉm) l√† bao nhi√™u?",
                options: [
                    "9.49 t·ª∑",
                    "10.49 t·ª∑",
                    "11.49 t·ª∑",
                    "8.99 t·ª∑"
                ],
                correct: 0,
                hint: null
            },
            {
                id: 7,
                difficulty: "medium",
                text: "M·ªôt m√°y m√≥c gi·∫£m 20% gi√° tr·ªã m·ªói nƒÉm. Sau bao nhi√™u nƒÉm gi√° tr·ªã c√≤n l·∫°i d∆∞·ªõi 1/3 gi√° tr·ªã ban ƒë·∫ßu? (L√†m tr√≤n l√™n)",
                options: [
                    "4 nƒÉm",
                    "5 nƒÉm",
                    "6 nƒÉm",
                    "7 nƒÉm"
                ],
                correct: 2,
                hint: null
            },
            {
                id: 8,
                difficulty: "medium",
                text: "M·ªôt b·ªÉ n∆∞·ªõc c√≥ 1000 l√≠t. M·ªói gi·ªù tho√°t ra 10% l∆∞·ª£ng n∆∞·ªõc c√≤n l·∫°i. Sau 5 gi·ªù c√≤n l·∫°i bao nhi√™u l√≠t n∆∞·ªõc? (L√†m tr√≤n ƒë·∫øn ch·ªØ s·ªë th·∫≠p ph√¢n th·ª© nh·∫•t)",
                options: [
                    "590.5 l√≠t",
                    "500.0 l√≠t",
                    "590.0 l√≠t",
                    "595.0 l√≠t"
                ],
                correct: 0,
                hint: null
            },
            // C√¢u kh√≥ (2 c√¢u)
            {
                id: 9,
                difficulty: "hard",
                text: "M·ªôt ng∆∞·ªùi g·ª≠i ti·∫øt ki·ªám 100 tri·ªáu ƒë·ªìng v·ªõi l√£i su·∫•t k√©p 0.6% m·ªói th√°ng. H·ªèi sau bao nhi√™u th√°ng s·ªë ti·ªÅn g·ªëc v√† l√£i ƒë·∫°t √≠t nh·∫•t 120 tri·ªáu? (S·ª≠ d·ª•ng c√¥ng th·ª©c logarit n·∫øu c·∫ßn)",
                options: [
                    "30 th√°ng",
                    "31 th√°ng",
                    "32 th√°ng",
                    "33 th√°ng"
                ],
                correct: 0,
                hint: "G·ª£i √Ω: S·ª≠ d·ª•ng c√¥ng th·ª©c A = P(1+r)^n, trong ƒë√≥ A = 120, P = 100, r = 0.006. Gi·∫£i ph∆∞∆°ng tr√¨nh 1.006^n ‚â• 1.2"
            },
            {
                id: 10,
                difficulty: "hard",
                text: "M·ªôt lo·∫°i thu·ªëc trong c∆° th·ªÉ gi·∫£m 30% n·ªìng ƒë·ªô m·ªói 4 gi·ªù. N·∫øu li·ªÅu ban ƒë·∫ßu l√† 500mg, sau bao nhi√™u gi·ªù n·ªìng ƒë·ªô thu·ªëc c√≤n d∆∞·ªõi 50mg?",
                options: [
                    "24 gi·ªù",
                    "28 gi·ªù",
                    "32 gi·ªù",
                    "36 gi·ªù"
                ],
                correct: 1,
                hint: "G·ª£i √Ω: Sau m·ªói 4 gi·ªù c√≤n 70% = 0.7. T√¨m n sao cho 500 √ó 0.7^n < 50, t·ª©c 0.7^n < 0.1. Nh·ªõ m·ªói n t∆∞∆°ng ·ª©ng 4 gi·ªù."
            }
        ];

        class QuizApp {
            constructor() {
                this.state = {
                    currentScreen: 'start',
                    currentQuestionIndex: 0,
                    answers: {},
                    score: 0,
                    timeLeft: QUIZ_CONFIG.totalTime,
                    timerInterval: null,
                    questionStartTime: null,
                    questionTimes: {},
                    consecutiveWrong: 0,
                    attemptCount: 0,
                    createdAt: Date.now(),
                    appSwitchCount: 0,
                    screenshotDetected: false,
                    showHint: {},
                    questionPool: [...QUESTIONS],
                    adaptiveQuestions: []
                };
                
                this.loadState();
                this.init();
            }

            loadState() {
                // Kh√¥ng d√πng localStorage, ch·ªâ ki·ªÉm tra th·ªùi gian trong phi√™n hi·ªán t·∫°i
                const now = Date.now();
                const expiryTime = this.state.createdAt + (QUIZ_CONFIG.expiryDays * 24 * 60 * 60 * 1000);
                
                if (now > expiryTime) {
                    this.showExpiredScreen();
                }
            }

            init() {
                this.setupEventListeners();
                this.render();
            }

            setupEventListeners() {
                // Ph√°t hi·ªán chuy·ªÉn app/tab
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && this.state.currentScreen === 'quiz') {
                        this.state.appSwitchCount++;
                        if (this.state.appSwitchCount <= 2) {
                            this.showWarning(`C·∫£nh b√°o: Ph√°t hi·ªán chuy·ªÉn ·ª©ng d·ª•ng l·∫ßn ${this.state.appSwitchCount}/2`);
                        } else {
                            this.forceSubmit('V∆∞·ª£t qu√° s·ªë l·∫ßn chuy·ªÉn ·ª©ng d·ª•ng cho ph√©p');
                        }
                    }
                });

                // Ph√°t hi·ªán ch·ª•p m√†n h√¨nh (∆∞·ªõc l∆∞·ª£ng)
                document.addEventListener('keyup', (e) => {
                    if ((e.key === 'PrintScreen' || e.key === 'Meta') && this.state.currentScreen === 'quiz') {
                        this.state.screenshotDetected = true;
                        this.showWarning('Ph√°t hi·ªán h√†nh vi ch·ª•p m√†n h√¨nh');
                    }
                });
            }

            showExpiredScreen() {
                const overlay = document.createElement('div');
                overlay.className = 'expired-overlay';
                overlay.innerHTML = `
                    <div class="expired-content">
                        <div class="expired-icon">‚è∞</div>
                        <h2 style="color: #dc3545; margin-bottom: 15px;">B√†i t·∫≠p ƒë√£ h·∫øt h·∫°n</h2>
                        <p style="color: #666; line-height: 1.6;">B√†i t·∫≠p n√†y ch·ªâ c√≥ hi·ªáu l·ª±c trong ${QUIZ_CONFIG.expiryDays} ng√†y k·ªÉ t·ª´ khi t·∫°o. Vui l√≤ng li√™n h·ªá gi√°o vi√™n ƒë·ªÉ nh·∫≠n b√†i t·∫≠p m·ªõi.</p>
                    </div>
                `;
                document.body.appendChild(overlay);
            }

            showWarning(message) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger';
                alertDiv.textContent = message;
                alertDiv.style.position = 'fixed';
                alertDiv.style.top = '20px';
                alertDiv.style.left = '50%';
                alertDiv.style.transform = 'translateX(-50%)';
                alertDiv.style.zIndex = '9999';
                document.body.appendChild(alertDiv);
                
                setTimeout(() => alertDiv.remove(), 3000);
            }

            startQuiz() {
                this.state.attemptCount++;
                if (this.state.attemptCount > QUIZ_CONFIG.maxAttempts) {
                    alert('B·∫°n ƒë√£ h·∫øt l∆∞·ª£t l√†m b√†i!');
                    return;
                }

                this.state.currentScreen = 'quiz';
                this.state.currentQuestionIndex = 0;
                this.state.answers = {};
                this.state.score = 0;
                this.state.timeLeft = QUIZ_CONFIG.totalTime;
                this.state.consecutiveWrong = 0;
                this.state.questionStartTime = Date.now();
                this.state.appSwitchCount = 0;
                this.state.screenshotDetected = false;
                
                this.startTimer();
                this.render();
            }

            startTimer() {
                if (this.state.timerInterval) clearInterval(this.state.timerInterval);
                
                this.state.timerInterval = setInterval(() => {
                    this.state.timeLeft--;
                    
                    if (this.state.timeLeft <= 0) {
                        this.forceSubmit('H·∫øt th·ªùi gian l√†m b√†i');
                    }
                    
                    this.updateTimer();
                }, 1000);
            }

            updateTimer() {
                const timerEl = document.getElementById('timer');
                if (timerEl) {
                    const minutes = Math.floor(this.state.timeLeft / 60);
                    const seconds = this.state.timeLeft % 60;
                    timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (this.state.timeLeft < 60) {
                        timerEl.classList.add('timer-warning');
                    }
                }
            }

            getCurrentQuestion() {
                return this.state.questionPool[this.state.currentQuestionIndex];
            }

            selectAnswer(optionIndex) {
                const question = this.getCurrentQuestion();
                this.state.answers[question.id] = optionIndex;
                this.render();
            }

            toggleHint(questionId) {
                this.state.showHint[questionId] = !this.state.showHint[questionId];
                this.render();
            }

            skipQuestion() {
                this.nextQuestion();
            }

            nextQuestion() {
                const question = this.getCurrentQuestion();
                const timeSpent = Math.floor((Date.now() - this.state.questionStartTime) / 1000);
                this.state.questionTimes[question.id] = timeSpent;

                // Ki·ªÉm tra ƒë√°p √°n v√† adaptive learning
                const userAnswer = this.state.answers[question.id];
                const isCorrect = userAnswer === question.correct;

                if (!isCorrect) {
                    this.state.consecutiveWrong++;
                } else {
                    this.state.consecutiveWrong = 0;
                }

                // Adaptive: Th√™m c√¢u h·ªèi d·ª±a tr√™n th·ªùi gian v√† ƒë·ªô ch√≠nh x√°c
                if (QUIZ_CONFIG.adaptiveEnabled) {
                    this.adaptiveAddQuestion(question, timeSpent, isCorrect);
                }

                if (this.state.currentQuestionIndex < this.state.questionPool.length - 1) {
                    this.state.currentQuestionIndex++;
                    this.state.questionStartTime = Date.now();
                    this.render();
                } else {
                    this.submitQuiz();
                }
            }

            adaptiveAddQuestion(currentQ, timeSpent, isCorrect) {
                // N·∫øu sai 3 c√¢u li√™n ti·∫øp, th√™m c√¢u d·ªÖ h∆°n
                if (this.state.consecutiveWrong >= QUIZ_CONFIG.consecutiveWrongLimit) {
                    const easierQ = QUESTIONS.find(q => 
                        q.difficulty === 'easy' && 
                        !this.state.questionPool.some(pq => pq.id === q.id)
                    );
                    if (easierQ) {
                        this.state.questionPool.push({...easierQ});
                        this.state.consecutiveWrong = 0;
                    }
                }

                // D·ª±a tr√™n th·ªùi gian l√†m b√†i
                if (timeSpent > QUIZ_CONFIG.timeThresholds[currentQ.difficulty]) {
                    let targetDifficulty;
                    if (currentQ.difficulty === 'hard') targetDifficulty = 'medium';
                    else if (currentQ.difficulty === 'medium') targetDifficulty = 'medium';
                    else targetDifficulty = 'easy';

                    const newQ = QUESTIONS.find(q => 
                        q.difficulty === targetDifficulty && 
                        !this.state.questionPool.some(pq => pq.id === q.id)
                    );
                    if (newQ) {
                        this.state.questionPool.push({...newQ});
                    }
                }
            }

            submitQuiz() {
                clearInterval(this.state.timerInterval);
                
                // T√≠nh ƒëi·ªÉm
                let correctCount = 0;
                this.state.questionPool.forEach(q => {
                    if (this.state.answers[q.id] === q.correct) {
                        correctCount++;
                        this.state.score += q.difficulty === 'easy' ? 1 : q.difficulty === 'medium' ? 2 : 3;
                    }
                });

                this.state.currentScreen = 'result';
                this.render();
            }

            forceSubmit(reason) {
                alert(reason + '. B√†i t·∫≠p s·∫Ω ƒë∆∞·ª£c n·ªôp.');
                this.submitQuiz();
            }

            render() {
                const app = document.getElementById('app');
                
                switch(this.state.currentScreen) {
                    case 'start':
                        app.innerHTML = this.renderStartScreen();
                        break;
                    case 'quiz':
                        app.innerHTML = this.renderQuizScreen();
                        break;
                    case 'result':
                        app.innerHTML = this.renderResultScreen();
                        break;
                }
            }

            renderStartScreen() {
                const expiryDate = new Date(this.state.createdAt + QUIZ_CONFIG.expiryDays * 24 * 60 * 60 * 1000);
                
                return `
                    <div class="header">
                        <h1>üìä ${QUIZ_CONFIG.subject}</h1>
                        <p style="color: #666; margin-top: 10px;">B√†i t·∫≠p tr·∫Øc nghi·ªám online</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìã Th√¥ng tin b√†i t·∫≠p</h3>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">S·ªë c√¢u h·ªèi:</span>
                                <strong>${QUESTIONS.length} c√¢u (5 d·ªÖ, 3 TB, 2 kh√≥)</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Th·ªùi gian:</span>
                                <strong>${QUIZ_CONFIG.totalTime / 60} ph√∫t</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">H·∫°n s·ª≠ d·ª•ng:</span>
                                <strong>${expiryDate.toLocaleDateString('vi-VN')}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">S·ªë l·∫ßn l√†m:</span>
                                <strong>${this.state.attemptCount}/${QUIZ_CONFIG.maxAttempts}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">H·ªá th·ªëng Adaptive:</span>
                                <strong style="color: #28a745;">‚úì B·∫≠t</strong>
                            </div>
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 20px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 25px;">
                        <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng</h4>
                        <ul style="color: #856404; line-height: 1.8; padding-left: 20px;">
                            <li>H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông th√™m c√¢u h·ªèi ph√π h·ª£p d·ª±a tr√™n k·∫øt qu·∫£ l√†m b√†i c·ªßa b·∫°n</li>
                            <li>C√¢u kh√≥ c√≥ g·ª£i √Ω, nh·∫•n n√∫t "üí° Xem g·ª£i √Ω" khi c·∫ßn</li>
                            <li>C√≥ th·ªÉ b·ªè qua c√¢u h·ªèi n·∫øu ch∆∞a bi·∫øt ƒë√°p √°n</li>
                            <li>Kh√¥ng ƒë∆∞·ª£c chuy·ªÉn ·ª©ng d·ª•ng qu√° 2 l·∫ßn (ph√°t hi·ªán t·ª± ƒë·ªông)</li>
                            <li>H·ªá th·ªëng ph√°t hi·ªán h√†nh vi ch·ª•p m√†n h√¨nh</li>
                            <li>Ch·ªâ c√≤n <strong>${QUIZ_CONFIG.maxAttempts - this.state.attemptCount}</strong> l∆∞·ª£t l√†m b√†i</li>
                        </ul>
                    </div>

                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="app.startQuiz()" style="font-size: 18px; padding: 15px 50px;">
                            üöÄ B·∫Øt ƒë·∫ßu l√†m b√†i
                        </button>
                    </div>
                `;
            }

            renderQuizScreen() {
                const question = this.getCurrentQuestion();
                const progress = ((this.state.currentQuestionIndex + 1) / this.state.questionPool.length) * 100;
                
                return `
                    <div class="header">
                        <h1>${QUIZ_CONFIG.subject}</h1>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>

                    <div class="info-bar">
                        <div class="info-item">
                            <div class="info-label">C√¢u h·ªèi</div>
                            <div class="info-value">${this.state.currentQuestionIndex + 1}/${this.state.questionPool.length}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Th·ªùi gian</div>
                            <div class="info-value" id="timer">--:--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ƒê√£ tr·∫£ l·ªùi</div>
                            <div class="info-value">${Object.keys(this.state.answers).length}</div>
                        </div>
                    </div>

                    ${this.state.appSwitchCount > 0 ? `
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è ƒê√£ ph√°t hi·ªán ${this.state.appSwitchCount}/2 l·∫ßn chuy·ªÉn ·ª©ng d·ª•ng
                        </div>
                    ` : ''}

                    <div class="question-container">
                        <div class="question-header">
                            <span class="question-number">C√¢u ${this.state.currentQuestionIndex + 1}</span>
                            <span class="difficulty-badge difficulty-${question.difficulty}">
                                ${question.difficulty === 'easy' ? '‚≠ê D·ªÖ' : question.difficulty === 'medium' ? '‚≠ê‚≠ê Trung b√¨nh' : '‚≠ê‚≠ê‚≠ê Kh√≥'}
                            </span>
                        </div>

                        <div class="question-text">${question.text}</div>

                        <div class="options">
                            ${question.options.map((opt, idx) => `
                                <div class="option ${this.state.answers[question.id] === idx ? 'selected' : ''}" 
                                     onclick="app.selectAnswer(${idx})">
                                    <div class="option-label">${String.fromCharCode(65 + idx)}</div>
                                    <div>${opt}</div>
                                </div>
                            `).join('')}
                        </div>

                        ${question.hint ? `
                            <div style="margin-top: 15px;">
                                <button class="btn btn-secondary" onclick="app.toggleHint(${question.id})" style="font-size: 14px;">
                                    üí° ${this.state.showHint[question.id] ? '·∫®n' : 'Xem'} g·ª£i √Ω
                                </button>
                            </div>
                            <div class="hint-section ${this.state.showHint[question.id] ? 'show' : ''}">
                                <div class="hint-title">üí° G·ª£i √Ω</div>
                                <div class="hint-text">${question.hint}</div>
                            </div>
                        ` : ''}
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="app.skipQuestion()">
                            ‚è≠Ô∏è B·ªè qua
                        </button>
                        <button class="btn btn-primary" 
                                onclick="app.nextQuestion()"
                                ${this.state.answers[question.id] === undefined ? 'disabled' : ''}>
                            ${this.state.currentQuestionIndex < this.state.questionPool.length - 1 ? 'C√¢u ti·∫øp theo ‚Üí' : '‚úì Ho√†n th√†nh'}
                        </button>
                    </div>
                `;
            }

            renderResultScreen() {
                const totalQuestions = this.state.questionPool.length;
                const answeredCount = Object.keys(this.state.answers).length;
                let correctCount = 0;
                let wrongCount = 0;

                this.state.questionPool.forEach(q => {
                    if (this.state.answers[q.id] !== undefined) {
                        if (this.state.answers[q.id] === q.correct) {
                            correctCount++;
                        } else {
                            wrongCount++;
                        }
                    }
                });

                const percentage = Math.round((correctCount / totalQuestions) * 100);
                const timeUsed = QUIZ_CONFIG.totalTime - this.state.timeLeft;
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;

                let message = '';
                let emoji = '';
                if (percentage >= 80) {
                    message = 'Xu·∫•t s·∫Øc! üéâ';
                    emoji = 'üèÜ';
                } else if (percentage >= 60) {
                    message = 'Kh√° t·ªët! üëç';
                    emoji = 'üòä';
                } else if (percentage >= 40) {
                    message = 'C·∫ßn c·ªë g·∫Øng h∆°n! üí™';
                    emoji = 'üòê';
                } else {
                    message = 'H√£y √¥n t·∫≠p th√™m nh√©! üìö';
                    emoji = 'üòî';
                }

                return `
                    <div class="result-card" style="user-select: text;">
                        <div style="font-size: 80px; margin-bottom: 20px;">${emoji}</div>
                        <h2 style="color: #667eea; margin-bottom: 10px;">${message}</h2>
                        <div class="result-score">${percentage}%</div>
                        <p style="color: #666; font-size: 18px;">ƒêi·ªÉm s·ªë: ${this.state.score} ƒëi·ªÉm</p>

                        <div class="result-details">
                            <div class="result-item">
                                <div class="result-item-value" style="color: #28a745;">${correctCount}</div>
                                <div class="result-item-label">ƒê√∫ng</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value" style="color: #dc3545;">${wrongCount}</div>
                                <div class="result-item-label">Sai</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value" style="color: #ffc107;">${totalQuestions - answeredCount}</div>
                                <div class="result-item-label">B·ªè qua</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                                <div class="result-item-label">Th·ªùi gian</div>
                            </div>
                        </div>

                        ${this.state.screenshotDetected ? `
                            <div class="alert alert-warning" style="text-align: left;">
                                ‚ö†Ô∏è ƒê√£ ph√°t hi·ªán h√†nh vi ch·ª•p m√†n h√¨nh trong qu√° tr√¨nh l√†m b√†i
                            </div>
                        ` : ''}

                        ${this.state.appSwitchCount > 0 ? `
                            <div class="alert alert-info" style="text-align: left;">
                                ‚ÑπÔ∏è S·ªë l·∫ßn chuy·ªÉn ·ª©ng d·ª•ng: ${this.state.appSwitchCount} l·∫ßn
                            </div>
                        ` : ''}

                        <div class="review-section">
                            <h3 style="color: #667eea; margin-bottom: 20px; text-align: center;">üìù Chi ti·∫øt ƒë√°p √°n</h3>
                            ${this.state.questionPool.map((q, idx) => {
                                const userAnswer = this.state.answers[q.id];
                                const isCorrect = userAnswer === q.correct;
                                const isSkipped = userAnswer === undefined;
                                
                                return `
                                    <div class="review-question ${!isCorrect && !isSkipped ? 'wrong' : ''}">
                                        <div class="review-header">
                                            <strong>C√¢u ${idx + 1}</strong>
                                            <span class="review-status ${isSkipped ? 'status-wrong' : isCorrect ? 'status-correct' : 'status-wrong'}">
                                                ${isSkipped ? '‚äò B·ªè qua' : isCorrect ? '‚úì ƒê√∫ng' : '‚úó Sai'}
                                            </span>
                                        </div>
                                        <p style="margin: 10px 0; color: #2c3e50;">${q.text}</p>
                                        ${!isSkipped ? `
                                            <div style="margin-top: 10px;">
                                                <div style="color: ${isCorrect ? '#28a745' : '#dc3545'}; margin-bottom: 5px;">
                                                    <strong>B·∫°n ch·ªçn:</strong> ${q.options[userAnswer]}
                                                </div>
                                            </div>
                                        ` : ''}
                                        <div style="margin-top: 8px; padding: 10px; background: #d4edda; border-radius: 8px; color: #155724;">
                                            <strong>‚úì ƒê√°p √°n ƒë√∫ng:</strong> ${q.options[q.correct]}
                                        </div>
                                        ${this.state.questionTimes[q.id] ? `
                                            <div style="margin-top: 8px; font-size: 13px; color: #666;">
                                                ‚è±Ô∏è Th·ªùi gian: ${this.state.questionTimes[q.id]}s
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            ${this.state.attemptCount < QUIZ_CONFIG.maxAttempts ? `
                                <button class="btn btn-primary" onclick="location.reload()">
                                    üîÑ L√†m l·∫°i (C√≤n ${QUIZ_CONFIG.maxAttempts - this.state.attemptCount} l∆∞·ª£t)
                                </button>
                            ` : `
                                <div class="alert alert-danger">
                                    B·∫°n ƒë√£ h·∫øt l∆∞·ª£t l√†m b√†i
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        const app = new QuizApp();

        // C·∫≠p nh·∫≠t timer ngay l·∫≠p t·ª©c khi b·∫Øt ƒë·∫ßu quiz
        setTimeout(() => {
            if (app.state.currentScreen === 'quiz') {
                app.updateTimer();
            }
        }, 100);
    </script>
</body>
</html>