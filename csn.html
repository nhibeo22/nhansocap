<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài tập Cấp số nhân</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .info-bar {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }

        .info-item {
            text-align: center;
            animation: popIn 0.6s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }

        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            animation: questionSlide 0.5s ease-out;
        }

        @keyframes questionSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        .difficulty-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .difficulty-easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #e8edff;
            font-weight: bold;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
            animation: correctPulse 0.6s ease;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option-label {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .hint-section {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            display: none;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .hint-section.show {
            display: block;
        }

        .hint-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint-text {
            color: #856404;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            animation: alertSlide 0.5s ease-out;
        }

        @keyframes alertSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .result-card {
            text-align: center;
            padding: 40px;
        }

        .result-score {
            font-size: 72px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
            animation: scoreCount 1s ease-out;
        }

        @keyframes scoreCount {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            animation: resultPop 0.6s ease-out;
        }

        @keyframes resultPop {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        .result-item-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-item-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .review-section {
            margin-top: 30px;
            text-align: left;
        }

        .review-question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .review-question.wrong {
            border-left-color: #dc3545;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-correct {
            background: #d4edda;
            color: #155724;
        }

        .status-wrong {
            background: #f8d7da;
            color: #721c24;
        }

        .expired-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.5s ease-in;
        }

        .expired-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            animation: popIn 0.8s ease-out;
        }

        .expired-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }

            .info-bar {
                flex-direction: column;
                gap: 10px;
            }

            .question-text {
                font-size: 16px;
            }

            .result-score {
                font-size: 48px;
            }

            .result-details {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        .timer-warning {
            color: #dc3545;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card" id="mainCard">
            <div id="app"></div>
        </div>
    </div>

    <script>
        const QUIZ_CONFIG = {
            subject: "Cấp số nhân - Bài toán thực tế",
            totalTime: 30 * 60,
            expiryDays: 3,
            maxAttempts: 2,
            adaptiveEnabled: true,
            timeThresholds: {
                easy: 120,
                medium: 180,
                hard: 300
            },
            consecutiveWrongLimit: 3
        };

        const QUESTIONS = [
            // Câu dễ (5 câu)
            {
                id: 1,
                difficulty: "easy",
                text: "Một vi khuẩn phân chia thành 2 con sau mỗi giờ. Ban đầu có 1 vi khuẩn, sau 5 giờ có bao nhiêu vi khuẩn?",
                options: [
                    "16 vi khuẩn",
                    "32 vi khuẩn",
                    "64 vi khuẩn",
                    "128 vi khuẩn"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 2,
                difficulty: "easy",
                text: "Một quả bóng được thả từ độ cao 10m, mỗi lần chạm đất nó nảy lên được 1/2 độ cao trước đó. Độ cao sau lần nảy thứ 3 là bao nhiêu?",
                options: [
                    "0.625m",
                    "1.25m",
                    "2.5m",
                    "5m"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 3,
                difficulty: "easy",
                text: "Một người gửi tiết kiệm 10 triệu đồng với lãi suất kép 0.5% mỗi tháng. Sau 1 tháng, số tiền gốc và lãi là bao nhiêu?",
                options: [
                    "10.05 triệu",
                    "10.5 triệu",
                    "10.055 triệu",
                    "11 triệu"
                ],
                correct: 0,
                hint: null
            },
            {
                id: 4,
                difficulty: "easy",
                text: "Dân số một thành phố là 100,000 người và tăng 2% mỗi năm. Sau 2 năm dân số là bao nhiêu người?",
                options: [
                    "104,000 người",
                    "104,040 người",
                    "102,000 người",
                    "106,000 người"
                ],
                correct: 1,
                hint: null
            },
            {
                id: 5,
                difficulty: "easy",
                text: "Một chiếc xe giảm giá 10% mỗi năm so với năm trước. Giá ban đầu là 500 triệu. Sau 2 năm giá xe còn bao nhiêu?",
                options: [
                    "400 triệu",
                    "405 triệu",
                    "450 triệu",
                    "425 triệu"
                ],
                correct: 1,
                hint: null
            },
            // Câu trung bình (3 câu)
            {
                id: 6,
                difficulty: "medium",
                text: "Một công ty có doanh thu năm đầu là 2 tỷ đồng và tăng trưởng 15% mỗi năm. Hỏi sau 4 năm tổng doanh thu tích lũy (cộng dồn 4 năm) là bao nhiêu?",
                options: [
                    "9.49 tỷ",
                    "10.49 tỷ",
                    "11.49 tỷ",
                    "8.99 tỷ"
                ],
                correct: 0,
                hint: null
            },
            {
                id: 7,
                difficulty: "medium",
                text: "Một máy móc giảm 20% giá trị mỗi năm. Sau bao nhiêu năm giá trị còn lại dưới 1/3 giá trị ban đầu? (Làm tròn lên)",
                options: [
                    "4 năm",
                    "5 năm",
                    "6 năm",
                    "7 năm"
                ],
                correct: 2,
                hint: null
            },
            {
                id: 8,
                difficulty: "medium",
                text: "Một bể nước có 1000 lít. Mỗi giờ thoát ra 10% lượng nước còn lại. Sau 5 giờ còn lại bao nhiêu lít nước? (Làm tròn đến chữ số thập phân thứ nhất)",
                options: [
                    "590.5 lít",
                    "500.0 lít",
                    "590.0 lít",
                    "595.0 lít"
                ],
                correct: 0,
                hint: null
            },
            // Câu khó (2 câu)
            {
                id: 9,
                difficulty: "hard",
                text: "Một người gửi tiết kiệm 100 triệu đồng với lãi suất kép 0.6% mỗi tháng. Hỏi sau bao nhiêu tháng số tiền gốc và lãi đạt ít nhất 120 triệu? (Sử dụng công thức logarit nếu cần)",
                options: [
                    "30 tháng",
                    "31 tháng",
                    "32 tháng",
                    "33 tháng"
                ],
                correct: 0,
                hint: "Gợi ý: Sử dụng công thức A = P(1+r)^n, trong đó A = 120, P = 100, r = 0.006. Giải phương trình 1.006^n ≥ 1.2"
            },
            {
                id: 10,
                difficulty: "hard",
                text: "Một loại thuốc trong cơ thể giảm 30% nồng độ mỗi 4 giờ. Nếu liều ban đầu là 500mg, sau bao nhiêu giờ nồng độ thuốc còn dưới 50mg?",
                options: [
                    "24 giờ",
                    "28 giờ",
                    "32 giờ",
                    "36 giờ"
                ],
                correct: 1,
                hint: "Gợi ý: Sau mỗi 4 giờ còn 70% = 0.7. Tìm n sao cho 500 × 0.7^n < 50, tức 0.7^n < 0.1. Nhớ mỗi n tương ứng 4 giờ."
            }
        ];

        class QuizApp {
            constructor() {
                this.state = {
                    currentScreen: 'start',
                    currentQuestionIndex: 0,
                    answers: {},
                    score: 0,
                    timeLeft: QUIZ_CONFIG.totalTime,
                    timerInterval: null,
                    questionStartTime: null,
                    questionTimes: {},
                    consecutiveWrong: 0,
                    attemptCount: 0,
                    createdAt: Date.now(),
                    appSwitchCount: 0,
                    screenshotDetected: false,
                    showHint: {},
                    questionPool: [...QUESTIONS],
                    adaptiveQuestions: []
                };
                
                this.loadState();
                this.init();
            }

            loadState() {
                // Không dùng localStorage, chỉ kiểm tra thời gian trong phiên hiện tại
                const now = Date.now();
                const expiryTime = this.state.createdAt + (QUIZ_CONFIG.expiryDays * 24 * 60 * 60 * 1000);
                
                if (now > expiryTime) {
                    this.showExpiredScreen();
                }
            }

            init() {
                this.setupEventListeners();
                this.render();
            }

            setupEventListeners() {
                // Phát hiện chuyển app/tab
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && this.state.currentScreen === 'quiz') {
                        this.state.appSwitchCount++;
                        if (this.state.appSwitchCount <= 2) {
                            this.showWarning(`Cảnh báo: Phát hiện chuyển ứng dụng lần ${this.state.appSwitchCount}/2`);
                        } else {
                            this.forceSubmit('Vượt quá số lần chuyển ứng dụng cho phép');
                        }
                    }
                });

                // Phát hiện chụp màn hình (ước lượng)
                document.addEventListener('keyup', (e) => {
                    if ((e.key === 'PrintScreen' || e.key === 'Meta') && this.state.currentScreen === 'quiz') {
                        this.state.screenshotDetected = true;
                        this.showWarning('Phát hiện hành vi chụp màn hình');
                    }
                });
            }

            showExpiredScreen() {
                const overlay = document.createElement('div');
                overlay.className = 'expired-overlay';
                overlay.innerHTML = `
                    <div class="expired-content">
                        <div class="expired-icon">⏰</div>
                        <h2 style="color: #dc3545; margin-bottom: 15px;">Bài tập đã hết hạn</h2>
                        <p style="color: #666; line-height: 1.6;">Bài tập này chỉ có hiệu lực trong ${QUIZ_CONFIG.expiryDays} ngày kể từ khi tạo. Vui lòng liên hệ giáo viên để nhận bài tập mới.</p>
                    </div>
                `;
                document.body.appendChild(overlay);
            }

            showWarning(message) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger';
                alertDiv.textContent = message;
                alertDiv.style.position = 'fixed';
                alertDiv.style.top = '20px';
                alertDiv.style.left = '50%';
                alertDiv.style.transform = 'translateX(-50%)';
                alertDiv.style.zIndex = '9999';
                document.body.appendChild(alertDiv);
                
                setTimeout(() => alertDiv.remove(), 3000);
            }

            startQuiz() {
                this.state.attemptCount++;
                if (this.state.attemptCount > QUIZ_CONFIG.maxAttempts) {
                    alert('Bạn đã hết lượt làm bài!');
                    return;
                }

                this.state.currentScreen = 'quiz';
                this.state.currentQuestionIndex = 0;
                this.state.answers = {};
                this.state.score = 0;
                this.state.timeLeft = QUIZ_CONFIG.totalTime;
                this.state.consecutiveWrong = 0;
                this.state.questionStartTime = Date.now();
                this.state.appSwitchCount = 0;
                this.state.screenshotDetected = false;
                
                this.startTimer();
                this.render();
            }

            startTimer() {
                if (this.state.timerInterval) clearInterval(this.state.timerInterval);
                
                this.state.timerInterval = setInterval(() => {
                    this.state.timeLeft--;
                    
                    if (this.state.timeLeft <= 0) {
                        this.forceSubmit('Hết thời gian làm bài');
                    }
                    
                    this.updateTimer();
                }, 1000);
            }

            updateTimer() {
                const timerEl = document.getElementById('timer');
                if (timerEl) {
                    const minutes = Math.floor(this.state.timeLeft / 60);
                    const seconds = this.state.timeLeft % 60;
                    timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (this.state.timeLeft < 60) {
                        timerEl.classList.add('timer-warning');
                    }
                }
            }

            getCurrentQuestion() {
                return this.state.questionPool[this.state.currentQuestionIndex];
            }

            selectAnswer(optionIndex) {
                const question = this.getCurrentQuestion();
                this.state.answers[question.id] = optionIndex;
                this.render();
            }

            toggleHint(questionId) {
                this.state.showHint[questionId] = !this.state.showHint[questionId];
                this.render();
            }

            skipQuestion() {
                this.nextQuestion();
            }

            nextQuestion() {
                const question = this.getCurrentQuestion();
                const timeSpent = Math.floor((Date.now() - this.state.questionStartTime) / 1000);
                this.state.questionTimes[question.id] = timeSpent;

                // Kiểm tra đáp án và adaptive learning
                const userAnswer = this.state.answers[question.id];
                const isCorrect = userAnswer === question.correct;

                if (!isCorrect) {
                    this.state.consecutiveWrong++;
                } else {
                    this.state.consecutiveWrong = 0;
                }

                // Adaptive: Thêm câu hỏi dựa trên thời gian và độ chính xác
                if (QUIZ_CONFIG.adaptiveEnabled) {
                    this.adaptiveAddQuestion(question, timeSpent, isCorrect);
                }

                if (this.state.currentQuestionIndex < this.state.questionPool.length - 1) {
                    this.state.currentQuestionIndex++;
                    this.state.questionStartTime = Date.now();
                    this.render();
                } else {
                    this.submitQuiz();
                }
            }

            adaptiveAddQuestion(currentQ, timeSpent, isCorrect) {
                // Nếu sai 3 câu liên tiếp, thêm câu dễ hơn
                if (this.state.consecutiveWrong >= QUIZ_CONFIG.consecutiveWrongLimit) {
                    const easierQ = QUESTIONS.find(q => 
                        q.difficulty === 'easy' && 
                        !this.state.questionPool.some(pq => pq.id === q.id)
                    );
                    if (easierQ) {
                        this.state.questionPool.push({...easierQ});
                        this.state.consecutiveWrong = 0;
                    }
                }

                // Dựa trên thời gian làm bài
                if (timeSpent > QUIZ_CONFIG.timeThresholds[currentQ.difficulty]) {
                    let targetDifficulty;
                    if (currentQ.difficulty === 'hard') targetDifficulty = 'medium';
                    else if (currentQ.difficulty === 'medium') targetDifficulty = 'medium';
                    else targetDifficulty = 'easy';

                    const newQ = QUESTIONS.find(q => 
                        q.difficulty === targetDifficulty && 
                        !this.state.questionPool.some(pq => pq.id === q.id)
                    );
                    if (newQ) {
                        this.state.questionPool.push({...newQ});
                    }
                }
            }

            submitQuiz() {
                clearInterval(this.state.timerInterval);
                
                // Tính điểm
                let correctCount = 0;
                this.state.questionPool.forEach(q => {
                    if (this.state.answers[q.id] === q.correct) {
                        correctCount++;
                        this.state.score += q.difficulty === 'easy' ? 1 : q.difficulty === 'medium' ? 2 : 3;
                    }
                });

                this.state.currentScreen = 'result';
                this.render();
            }

            forceSubmit(reason) {
                alert(reason + '. Bài tập sẽ được nộp.');
                this.submitQuiz();
            }

            render() {
                const app = document.getElementById('app');
                
                switch(this.state.currentScreen) {
                    case 'start':
                        app.innerHTML = this.renderStartScreen();
                        break;
                    case 'quiz':
                        app.innerHTML = this.renderQuizScreen();
                        break;
                    case 'result':
                        app.innerHTML = this.renderResultScreen();
                        break;
                }
            }

            renderStartScreen() {
                const expiryDate = new Date(this.state.createdAt + QUIZ_CONFIG.expiryDays * 24 * 60 * 60 * 1000);
                
                return `
                    <div class="header">
                        <h1>📊 ${QUIZ_CONFIG.subject}</h1>
                        <p style="color: #666; margin-top: 10px;">Bài tập trắc nghiệm online</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">📋 Thông tin bài tập</h3>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Số câu hỏi:</span>
                                <strong>${QUESTIONS.length} câu (5 dễ, 3 TB, 2 khó)</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Thời gian:</span>
                                <strong>${QUIZ_CONFIG.totalTime / 60} phút</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Hạn sử dụng:</span>
                                <strong>${expiryDate.toLocaleDateString('vi-VN')}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Số lần làm:</span>
                                <strong>${this.state.attemptCount}/${QUIZ_CONFIG.maxAttempts}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Hệ thống Adaptive:</span>
                                <strong style="color: #28a745;">✓ Bật</strong>
                            </div>
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 20px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 25px;">
                        <h4 style="color: #856404; margin-bottom: 10px;">⚠️ Lưu ý quan trọng</h4>
                        <ul style="color: #856404; line-height: 1.8; padding-left: 20px;">
                            <li>Hệ thống sẽ tự động thêm câu hỏi phù hợp dựa trên kết quả làm bài của bạn</li>
                            <li>Câu khó có gợi ý, nhấn nút "💡 Xem gợi ý" khi cần</li>
                            <li>Có thể bỏ qua câu hỏi nếu chưa biết đáp án</li>
                            <li>Không được chuyển ứng dụng quá 2 lần (phát hiện tự động)</li>
                            <li>Hệ thống phát hiện hành vi chụp màn hình</li>
                            <li>Chỉ còn <strong>${QUIZ_CONFIG.maxAttempts - this.state.attemptCount}</strong> lượt làm bài</li>
                        </ul>
                    </div>

                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="app.startQuiz()" style="font-size: 18px; padding: 15px 50px;">
                            🚀 Bắt đầu làm bài
                        </button>
                    </div>
                `;
            }

            renderQuizScreen() {
                const question = this.getCurrentQuestion();
                const progress = ((this.state.currentQuestionIndex + 1) / this.state.questionPool.length) * 100;
                
                return `
                    <div class="header">
                        <h1>${QUIZ_CONFIG.subject}</h1>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>

                    <div class="info-bar">
                        <div class="info-item">
                            <div class="info-label">Câu hỏi</div>
                            <div class="info-value">${this.state.currentQuestionIndex + 1}/${this.state.questionPool.length}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Thời gian</div>
                            <div class="info-value" id="timer">--:--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Đã trả lời</div>
                            <div class="info-value">${Object.keys(this.state.answers).length}</div>
                        </div>
                    </div>

                    ${this.state.appSwitchCount > 0 ? `
                        <div class="alert alert-warning">
                            ⚠️ Đã phát hiện ${this.state.appSwitchCount}/2 lần chuyển ứng dụng
                        </div>
                    ` : ''}

                    <div class="question-container">
                        <div class="question-header">
                            <span class="question-number">Câu ${this.state.currentQuestionIndex + 1}</span>
                            <span class="difficulty-badge difficulty-${question.difficulty}">
                                ${question.difficulty === 'easy' ? '⭐ Dễ' : question.difficulty === 'medium' ? '⭐⭐ Trung bình' : '⭐⭐⭐ Khó'}
                            </span>
                        </div>

                        <div class="question-text">${question.text}</div>

                        <div class="options">
                            ${question.options.map((opt, idx) => `
                                <div class="option ${this.state.answers[question.id] === idx ? 'selected' : ''}" 
                                     onclick="app.selectAnswer(${idx})">
                                    <div class="option-label">${String.fromCharCode(65 + idx)}</div>
                                    <div>${opt}</div>
                                </div>
                            `).join('')}
                        </div>

                        ${question.hint ? `
                            <div style="margin-top: 15px;">
                                <button class="btn btn-secondary" onclick="app.toggleHint(${question.id})" style="font-size: 14px;">
                                    💡 ${this.state.showHint[question.id] ? 'Ẩn' : 'Xem'} gợi ý
                                </button>
                            </div>
                            <div class="hint-section ${this.state.showHint[question.id] ? 'show' : ''}">
                                <div class="hint-title">💡 Gợi ý</div>
                                <div class="hint-text">${question.hint}</div>
                            </div>
                        ` : ''}
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="app.skipQuestion()">
                            ⏭️ Bỏ qua
                        </button>
                        <button class="btn btn-primary" 
                                onclick="app.nextQuestion()"
                                ${this.state.answers[question.id] === undefined ? 'disabled' : ''}>
                            ${this.state.currentQuestionIndex < this.state.questionPool.length - 1 ? 'Câu tiếp theo →' : '✓ Hoàn thành'}
                        </button>
                    </div>
                `;
            }

            renderResultScreen() {
                const totalQuestions = this.state.questionPool.length;
                const answeredCount = Object.keys(this.state.answers).length;
                let correctCount = 0;
                let wrongCount = 0;

                this.state.questionPool.forEach(q => {
                    if (this.state.answers[q.id] !== undefined) {
                        if (this.state.answers[q.id] === q.correct) {
                            correctCount++;
                        } else {
                            wrongCount++;
                        }
                    }
                });

                const percentage = Math.round((correctCount / totalQuestions) * 100);
                const timeUsed = QUIZ_CONFIG.totalTime - this.state.timeLeft;
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;

                let message = '';
                let emoji = '';
                if (percentage >= 80) {
                    message = 'Xuất sắc! 🎉';
                    emoji = '🏆';
                } else if (percentage >= 60) {
                    message = 'Khá tốt! 👍';
                    emoji = '😊';
                } else if (percentage >= 40) {
                    message = 'Cần cố gắng hơn! 💪';
                    emoji = '😐';
                } else {
                    message = 'Hãy ôn tập thêm nhé! 📚';
                    emoji = '😔';
                }

                return `
                    <div class="result-card" style="user-select: text;">
                        <div style="font-size: 80px; margin-bottom: 20px;">${emoji}</div>
                        <h2 style="color: #667eea; margin-bottom: 10px;">${message}</h2>
                        <div class="result-score">${percentage}%</div>
                        <p style="color: #666; font-size: 18px;">Điểm số: ${this.state.score} điểm</p>

                        <div class="result-details">
                            <div class="result-item">
                                <div class="result-item-value" style="color: #28a745;">${correctCount}</div>
                                <div class="result-item-label">Đúng</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value" style="color: #dc3545;">${wrongCount}</div>
                                <div class="result-item-label">Sai</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value" style="color: #ffc107;">${totalQuestions - answeredCount}</div>
                                <div class="result-item-label">Bỏ qua</div>
                            </div>
                            <div class="result-item">
                                <div class="result-item-value">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                                <div class="result-item-label">Thời gian</div>
                            </div>
                        </div>

                        ${this.state.screenshotDetected ? `
                            <div class="alert alert-warning" style="text-align: left;">
                                ⚠️ Đã phát hiện hành vi chụp màn hình trong quá trình làm bài
                            </div>
                        ` : ''}

                        ${this.state.appSwitchCount > 0 ? `
                            <div class="alert alert-info" style="text-align: left;">
                                ℹ️ Số lần chuyển ứng dụng: ${this.state.appSwitchCount} lần
                            </div>
                        ` : ''}

                        <div class="review-section">
                            <h3 style="color: #667eea; margin-bottom: 20px; text-align: center;">📝 Chi tiết đáp án</h3>
                            ${this.state.questionPool.map((q, idx) => {
                                const userAnswer = this.state.answers[q.id];
                                const isCorrect = userAnswer === q.correct;
                                const isSkipped = userAnswer === undefined;
                                
                                return `
                                    <div class="review-question ${!isCorrect && !isSkipped ? 'wrong' : ''}">
                                        <div class="review-header">
                                            <strong>Câu ${idx + 1}</strong>
                                            <span class="review-status ${isSkipped ? 'status-wrong' : isCorrect ? 'status-correct' : 'status-wrong'}">
                                                ${isSkipped ? '⊘ Bỏ qua' : isCorrect ? '✓ Đúng' : '✗ Sai'}
                                            </span>
                                        </div>
                                        <p style="margin: 10px 0; color: #2c3e50;">${q.text}</p>
                                        ${!isSkipped ? `
                                            <div style="margin-top: 10px;">
                                                <div style="color: ${isCorrect ? '#28a745' : '#dc3545'}; margin-bottom: 5px;">
                                                    <strong>Bạn chọn:</strong> ${q.options[userAnswer]}
                                                </div>
                                            </div>
                                        ` : ''}
                                        <div style="margin-top: 8px; padding: 10px; background: #d4edda; border-radius: 8px; color: #155724;">
                                            <strong>✓ Đáp án đúng:</strong> ${q.options[q.correct]}
                                        </div>
                                        ${this.state.questionTimes[q.id] ? `
                                            <div style="margin-top: 8px; font-size: 13px; color: #666;">
                                                ⏱️ Thời gian: ${this.state.questionTimes[q.id]}s
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            ${this.state.attemptCount < QUIZ_CONFIG.maxAttempts ? `
                                <button class="btn btn-primary" onclick="location.reload()">
                                    🔄 Làm lại (Còn ${QUIZ_CONFIG.maxAttempts - this.state.attemptCount} lượt)
                                </button>
                            ` : `
                                <div class="alert alert-danger">
                                    Bạn đã hết lượt làm bài
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }
        }

        // Khởi tạo ứng dụng
        const app = new QuizApp();

        // Cập nhật timer ngay lập tức khi bắt đầu quiz
        setTimeout(() => {
            if (app.state.currentScreen === 'quiz') {
                app.updateTimer();
            }
        }, 100);
    </script>
</body>
</html>